<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Eco Collect - Admin Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f6fff6; }
    .section-title { margin-top: 40px; margin-bottom: 20px; }
    img.waste-preview { max-width: 100px; max-height: 100px; object-fit: cover; }
    .status-completed { color: green; font-weight: bold; }
    .status-completing { color: blue; font-weight: bold; }
    .status-pending { color: red; font-weight: bold; }
  </style>
</head>
<body>
<div class="container mt-4">
  <h2 class="text-center mb-4">Eco Collect Admin Login</h2>
  <div id="loginForm">
    <input type="password" id="adminPassword" class="form-control mb-3" placeholder="Enter admin password">
    <button class="btn btn-success w-100" onclick="checkPassword()">Login</button>
    <div id="loginError" class="text-danger mt-2 text-center"></div>
  </div>

  <div id="adminPanel" style="display:none;">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-success mb-4">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Eco Collect Admin</a>
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link text-white" href="#pricing">Pricing</a></li>
          <li class="nav-item"><a class="nav-link text-white" href="#orders">Orders</a></li>
          <li class="nav-item"><a class="nav-link text-white" href="#messages">Messages</a></li>
        </ul>
      </div>
    </nav>

    <!-- Pricing Section -->
    <section id="pricing">
      <h3 class="section-title text-success">Manage Pricing</h3>
      <form id="itemForm" class="row g-3">
        <div class="col-md-4">
          <input type="text" id="name" class="form-control" placeholder="Category Name" required />
        </div>
        <div class="col-md-4">
          <input type="text" id="desc" class="form-control" placeholder="Description" required />
        </div>
        <div class="col-md-2">
          <input type="number" id="price" class="form-control" placeholder="Price ₹" required />
        </div>
        <div class="col-md-2">
          <input type="text" id="image" class="form-control" placeholder="Image URL" required />
        </div>
        <div class="col-12 text-end">
          <button type="submit" class="btn btn-success">Add Item</button>
        </div>
      </form>
      <div class="row mt-4" id="itemsList"></div>
    </section>

    <!-- Orders Section -->
    <section id="orders">
      <h3 class="section-title text-success">Scheduled Orders</h3>
      <table class="table table-bordered">
        <thead class="table-success">
        <tr>
          <th>Name</th>
          <th>Mobile</th>
          <th>Address</th>
          <th>Image</th>
          <th>Time</th>
          <th>Status</th>
        </tr>
        </thead>
        <tbody id="orderTableBody"></tbody>
      </table>
    </section>

    <!-- Messages Section -->
    <section id="messages">
      <h3 class="section-title text-success">Customer Messages</h3>
      <table class="table table-bordered">
        <thead class="table-success">
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Message</th>
          <th>Time</th>
        </tr>
        </thead>
        <tbody id="messageTableBody"></tbody>
      </table>
    </section>
  </div>
</div>

<script>
  const correctPassword = "admin123";

  function checkPassword() {
    const input = document.getElementById("adminPassword").value;
    if (input === correctPassword) {
      document.getElementById("loginForm").style.display = "none";
      document.getElementById("adminPanel").style.display = "block";
      renderItems();
      loadOrders();
      loadMessages();
    } else {
      document.getElementById("loginError").innerText = "Incorrect password!";
    }
  }

  // Pricing
  let items = JSON.parse(localStorage.getItem("items") || "[]");

  function saveItems() {
    localStorage.setItem("items", JSON.stringify(items));
    renderItems();
  }

  function renderItems() {
    const container = document.getElementById("itemsList");
    container.innerHTML = "";
    items.forEach((item, index) => {
      const col = document.createElement("div");
      col.className = "col-md-4 mb-4";
      col.innerHTML = `
        <div class="card h-100">
          <img src="${item.image}" class="card-img-top" style="height:200px; object-fit:cover;">
          <div class="card-body">
            <h5 class="card-title">${item.name}</h5>
            <p>${item.desc}</p>
            <p><strong>₹${item.price}</strong></p>
            <button class="btn btn-danger btn-sm" onclick="deleteItem(${index})">Delete</button>
          </div>
        </div>`;
      container.appendChild(col);
    });
  }

  function deleteItem(index) {
    items.splice(index, 1);
    saveItems();
  }

  document.getElementById("itemForm").addEventListener("submit", function (e) {
    e.preventDefault();
    const name = document.getElementById("name").value.trim();
    const desc = document.getElementById("desc").value.trim();
    const price = document.getElementById("price").value.trim();
    const image = document.getElementById("image").value.trim();

    if (name && desc && price && image) {
      items.push({ name, desc, price, image });
      saveItems();
      this.reset();
    }
  });

  // Orders
  function loadOrders() {
    const orders = JSON.parse(localStorage.getItem("scheduledOrders")) || [];
    const tableBody = document.getElementById("orderTableBody");
    tableBody.innerHTML = "";

    orders.forEach((order, index) => {
      if (!order.status) order.status = "Pending";  // default status

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${order.name}</td>
        <td>${order.mobile || "-"}</td>
        <td>${order.address}</td>
        <td><img src="${order.image}" class="waste-preview" /></td>
        <td>${order.time}</td>
        <td>
          <select class="form-select status-dropdown ${getStatusClass(order.status)}"
                  onchange="updateOrderStatus(${index}, this.value)">
            <option value="Completed" ${order.status === "Completed" ? "selected" : ""}>Completed</option>
            <option value="Completing" ${order.status === "Completing" ? "selected" : ""}>Completing</option>
            <option value="Pending" ${order.status === "Pending" ? "selected" : ""}>Pending</option>
          </select>
        </td>
      `;
      tableBody.appendChild(row);
    });

    // Save updated orders with status
    localStorage.setItem("scheduledOrders", JSON.stringify(orders));
  }

  function updateOrderStatus(index, newStatus) {
    const orders = JSON.parse(localStorage.getItem("scheduledOrders")) || [];
    orders[index].status = newStatus;
    localStorage.setItem("scheduledOrders", JSON.stringify(orders));
    loadOrders();  // Refresh table to apply color
  }

  function getStatusClass(status) {
    if (status === "Completed") return "status-completed";
    if (status === "Completing") return "status-completing";
    return "status-pending";
  }

  // Messages
  function loadMessages() {
    const messages = JSON.parse(localStorage.getItem("contactMessages")) || [];
    const tableBody = document.getElementById("messageTableBody");
    tableBody.innerHTML = "";

    messages.forEach(msg => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${msg.name}</td>
        <td>${msg.email}</td>
        <td>${msg.message}</td>
        <td>${msg.time}</td>
      `;
      tableBody.appendChild(row);
    });
  }
</script>
</body>
</html>
